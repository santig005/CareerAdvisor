{% extends "base.html" %}
{% load static %}
{% block title %} Perfilamiento {% endblock %}

{% block content %}
<div class="container">
    <h1 style="padding-bottom: 50px;" >D√©janos saber un poco m√°s de ti üòÅ</h1>
        <div class="row"style="padding-bottom: 50px;" >
            <div class="col-md-4">
                <input type="text" class="form-control" name="nombre" placeholder="Nombre">
            </div>
            <div class="col-md-4">
                <input type="text" class="form-control" name="edad" placeholder="Edad">
            </div>
            <div class="col-md-4">
                <input type="email" class="form-control" name="email" placeholder="Email">
            </div>
        </div>
    <div class="mt-4"style="padding-top=50px;padding-bottom: 50px;">
        <h2 style="padding-bottom: 50px;">¬øTienes estudios formales?</h2>
        <div class="row">
            <div class="card col-md-4"style="max-width: 25%; max-height: 25%;">
                <a id="studies-link"href=""><img id="studies-image"src="{% static 'assets/img/studies.jpg' %}" class="rounded-circle img-fluid border inactive"></a>
                <h5 class="text-center mt-3 mb-3" style="text-transform: uppercase;">S√≠ tengo</h5>
            </div>
            <div id="studies" style="display:none">
                <div class="row d-flex">
                    {% for level in levels %}
                    <div class="card col-md-4"style="max-width: 20%; max-height: 20%;">
                        <a id="{{level.0}}-link"href=""><img id="{{level.0}}-image"src="{% static 'assets/img/studies.jpg' %}" class="rounded-circle img-fluid border inactive"></a>
                        <h5 class="text-center mt-3 mb-3" style="text-transform: uppercase;">{{level.0}}</h5>
                    </div>
                    <div id="{{level.0}}" style="display:none">
                        <div class="row d-flex">
                            {% for under in level.1 %}
                            <div class="card col-md-4"style="max-width: 18%; max-height: 18%;">
                                <a data-course-id="{{under.idcourse}}" data-selected="false" id="course-link-{{under.idcourse}}"class="course-link {{level.0}}" href=""><img id="course-image-{{under.idcourse}}"src="{% static 'assets/img/studies.jpg' %}" class="rounded-circle img-fluid border inactive"></a>
                            <h5 class="text-center mt-3 mb-3" style="text-transform: uppercase;">{{under.name}}</h5>
                            </div>
                            <div id="university-{{under.idcourse}}" style="display:none">
                                <div class="row d-flex">
                                    {% for uni in under.universities %}
                                    <div class="card col-md-4"style="max-width: 15%; max-height: 15%;">
                                        <a data-university-id="{{uni.idcollege}}" data-selected="false" id="university-link-{{under.idcourse}}-{{uni.idcollege}}"data-course-id="{{under.idcourse}}"class="university-link" href=""><img id="university-image-{{under.idcourse}}-{{uni.idcollege}}"src="{{ uni.logo.url }}" class="rounded-circle img-fluid border inactive"></a>
                                    <h5 class="text-center mt-3 mb-3" style="text-transform: uppercase;">{{uni.name}}</h5>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>  
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card col-md-4"style="max-width: 25%; max-height: 25%;">
                <a id="no-studies-link"href=""><img id="no-studies-image"src="{% static 'assets/img/studies.jpg' %}" class="rounded-circle img-fluid border inactive"></a>
                <h5 class="text-center mt-3 mb-3" style="text-transform: uppercase;">No, Ninguno</h5>
            </div>
        </div>
    </div>
    <form id="my-form" method="POST" action="{% url 'results' %}">
        {% csrf_token %}
    
        <!-- Agregar campos ocultos para opciones seleccionadas -->
        <input type="hidden" name="estudios" id="studies-selected" value="">
        {% for level in levels %}
        <input type="hidden" name="{{level.0}}" id="{{level.0}}-selected" value="">
        {% endfor %}
        <input type="hidden" name="cursos" id="courses-selected" value="">
        <input type="hidden" name="universidades" id="universities-selected" value="">
        <button type="submit" class="btn btn-primary send_button py-sm-3 px-sm-5">Enviar</button>
    </form>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        function unselect_image(item){
            item.classList.remove("active");
            item.classList.add("inactive");
        }
        function select_image(item){
            item.classList.remove("inactive");
            item.classList.add("active");
        }
        function unselect_universities(courseId){
            universityLinks.forEach (university => {
                const universityId = university.dataset.universityId;
                    const universityImage = document.getElementById(`university-image-${courseId}-${universityId}`);
                    const universityLink = document.getElementById(`university-link-${courseId}-${universityId}`);
                    if (universityLink && universityLink.classList.contains("selected")) {
                    unselect_image(universityImage)
                    universityLink.classList.remove("selected");
                    }
                }
            );
        }
        function unselect_courses(level){
            const levelLink = document.getElementById(level+"-link");
            const levelSection = document.getElementById(level);
            const levelImage = document.getElementById(level+"-image");
            if (levelSection.style.display === "block") {
                unselect_image(levelImage)
                levelSection.style.display = "none";
            }
            const courseLinks = document.querySelectorAll("."+level);
            courseLinks.forEach(course => {
                const courseId = course.dataset.courseId;
                const courseImage = document.getElementById(`course-image-${courseId}`);
                const courseLink = document.getElementById(`course-link-${courseId}`);
                const universitySection = document.getElementById(`university-${courseId}`);
                if (courseLink.classList.contains("selected")) {
                unselect_image(courseImage)
                courseLink.classList.remove("selected");
                universitySection.style.display = "none";
                }
                unselect_universities(courseId);
            });
        }
        const studiesLink = document.getElementById("studies-link");
        const studiesSection = document.getElementById("studies");
        const studiesImage = document.getElementById("studies-image");
        studiesLink.addEventListener("click", function(e) {
            e.preventDefault();
            if (studiesSection.style.display === "none") {
                if(noStudiesImage.classList.contains("active")){
                    unselect_image(noStudiesImage)
                }
                select_image(studiesImage)
                studiesSection.style.display = "block";
            } else {
                unselect_image(studiesImage)
                studiesSection.style.display = "none";
                unselect_courses("pregrado");
                unselect_courses("maestr√≠a");
                unselect_courses("doctorado");
            }
        });
        // This script display the studies section when "No, no tengo" option is selected
        const noStudiesLink = document.getElementById("no-studies-link");
        const noStudiesImage = document.getElementById("no-studies-image");
        const courseLinks = document.querySelectorAll(".course-link");
        noStudiesLink.addEventListener("click", function(e) {
            e.preventDefault();
            if (studiesSection.style.display === "block") {
                unselect_image(studiesImage)
                select_image(noStudiesImage)
                studiesSection.style.display = "none";
            }
            else{
                if(noStudiesImage.classList.contains("active")){
                    unselect_image(noStudiesImage)
                }
                else{
                    select_image(noStudiesImage)

                }
            }
            unselect_courses("pregrado");
            unselect_courses("maestr√≠a");
            unselect_courses("doctorado");
        });
        function event_level(level){
            const levelLink = document.getElementById(level+"-link");
            const levelSection = document.getElementById(level);
            const levelImage = document.getElementById(level+"-image");
            levelLink.addEventListener("click", function(e) {
            e.preventDefault();
            if (levelSection.style.display === "none") {
                select_image(levelImage)
                levelSection.style.display = "block";
            } else {
                unselect_courses(level)
            }
            });
        }
        event_level("pregrado")
        event_level("maestr√≠a")
        event_level("doctorado")
        courseLinks.forEach(function(link) {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                const courseId = link.dataset.courseId;
                const courseImage = document.getElementById(`course-image-${courseId}`);
                const courseLink = document.getElementById(`course-link-${courseId}`);
                const universitySection = document.getElementById(`university-${courseId}`);
                if (courseLink.classList.contains("selected")) {
                unselect_image(courseImage)
                courseLink.classList.remove("selected");
                universitySection.style.display = "none";
                unselect_universities(courseId);
                } else {
                    select_image(courseImage)
                    courseLink.classList.add("selected");
                    universitySection.style.display = "block";
                }
            });
        });
        const universityLinks = document.querySelectorAll(".university-link");
        universityLinks.forEach(function(link) {
            link.addEventListener("click", function(e) {
                e.preventDefault();
                const universityId = link.dataset.universityId;
                const courseId = link.dataset.courseId;
                const universityImage = document.getElementById(`university-image-${courseId}-${universityId}`);
                const universityLink = document.getElementById(`university-link-${courseId}-${universityId}`);
                if (universityLink.classList.contains("selected")) {
                    unselect_image(universityImage)
                    universityLink.classList.remove("selected");
                } else{
                    select_image(universityImage)
                    universityLink.classList.add("selected");
                }
            });
        });
        const form = document.getElementById("my-form");
        const studiesSelected = document.getElementById("studies-selected");
        const undergraduateSelected = document.getElementById("pregrado-selected");
        const masterSelected = document.getElementById("maestr√≠a-selected");
        const doctorateSelected = document.getElementById("doctorado-selected");
        const coursesSelected = document.getElementById("courses-selected");
        const universitiesSelected = document.getElementById("universities-selected");
        const sendButton = document.querySelector(".send_button");

        sendButton.addEventListener("click", function(e) {
            e.preventDefault();
            const estudios = document.getElementById("studies").style.display === "block" ? "S√≠" : "No";
            const undergraduate = document.getElementById("pregrado").style.display === "block" ? "Pregrado" : "";
            const master = document.getElementById("maestr√≠a").style.display === "block" ? "Master" : "";
            const doctorate = document.getElementById("doctorado").style.display === "block" ? "Doctorado" : "";
            const selectedCursos = document.querySelectorAll(".course-link.selected");
            const selectedUniversities = document.querySelectorAll(".university-link.selected");
            const cursos = Array.from(selectedCursos).map(course => course.dataset.courseId).join(", ");
            const universities = Array.from(selectedUniversities).map(university => university.dataset.universityId).join(", ");
            studiesSelected.value = estudios;
            undergraduateSelected.value = undergraduate;
            masterSelected.value = master;
            doctorateSelected.value = doctorate;            
            coursesSelected.value = cursos;
            universitiesSelected.value = universities;
            form.submit();
        });
        
    });

</script>   

{% endblock %}